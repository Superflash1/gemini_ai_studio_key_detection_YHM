# Gemini API 密钥检测系统

## 项目概述

这是一个用于批量检测 Google Gemini API 密钥有效性的 Web 应用系统。该系统提供了一个直观的 Web 界面，允许用户管理 API 密钥、配置检测参数，并实时查看检测结果。

## 主要功能

### 1. 密钥管理
- **批量导入**：支持从文本文件批量导入 API 密钥
- **手动添加**：单个密钥的手动添加和编辑
- **状态跟踪**：实时显示每个密钥的状态（有效/无效/未检测）
- **分类管理**：自动将密钥分类为有效和无效

### 2. 自动化检测
- **定时检测**：支持设置检测间隔，自动执行密钥验证
- **手动检测**：可随时手动触发密钥检测
- **并发处理**：支持多线程并发检测，提高效率
- **实时进度**：检测过程中显示实时进度和状态

### 3. 高级配置
- **代理支持**：支持通过代理服务器访问 API
- **自定义端点**：支持使用自定义 API 端点
- **检测参数**：可配置并发数、超时时间等参数
- **邮件通知**：检测完成后可发送邮件通知

### 4. Web 界面
- **实时日志**：Web 页面实时显示检测日志
- **状态监控**：查看当前检测状态和统计信息
- **历史记录**：查看历史检测记录
- **配置管理**：通过 Web 界面修改系统配置

## 技术架构

### 后端技术栈
- **Flask**：Web 框架，提供 API 和页面路由
- **SQLAlchemy**：数据库 ORM，管理密钥和配置数据
- **APScheduler**：任务调度器，处理定时检测任务
- **SQLite**：轻量级数据库，存储应用数据
- **Threading**：多线程处理，实现并发检测

### 前端技术栈
- **Bootstrap**：响应式 UI 框架
- **JavaScript**：前端交互逻辑
- **Server-Sent Events (SSE)**：实时日志推送
- **AJAX**：异步数据交互

### 核心模块

#### 1. app.py - 主应用模块
```python
主要功能：
- Flask 应用初始化和配置
- 数据库连接和表创建
- 路由定义和请求处理
- 静态文件和模板渲染
```

#### 2. scheduler.py - 任务调度模块
```python
主要功能：
- 后台调度器管理
- 密钥检测任务执行
- 并发控制和线程安全
- 实时日志推送
- 邮件通知触发
```

#### 3. models.py - 数据模型
```python
数据表设计：
- ApiKey: 存储 API 密钥信息
- CheckLog: 记录检测历史
- Settings: 系统配置参数
```

#### 4. gemini_key_checker/ - 核心检测模块
```python
检测逻辑：
- Google Gemini API 调用
- 自定义 API 端点支持
- 代理配置处理
- 异常处理和错误分类
```

#### 5. email_notifier.py - 邮件通知模块
```python
通知功能：
- Gmail SMTP 配置
- 多收件人支持
- 检测结果摘要
- 错误处理
```

## 工作流程

### 1. 系统启动流程
```
1. 加载 Flask 应用
2. 初始化数据库连接
3. 创建数据表（如果不存在）
4. 初始化默认配置
5. 启动后台调度器
6. 启动 Web 服务器
```

### 2. 密钥检测流程
```
1. 从数据库获取待检测密钥
2. 读取系统配置参数
3. 创建检测任务并发执行
4. 调用 Gemini API 验证密钥
5. 记录检测结果到数据库
6. 更新密钥状态
7. 推送实时日志到前端
8. 发送邮件通知（如启用）
```

### 3. Web 界面交互流程
```
1. 用户访问 Web 界面
2. 页面加载密钥列表和配置
3. 建立 SSE 连接接收实时日志
4. 用户操作触发 AJAX 请求
5. 后端处理请求并返回结果
6. 前端更新界面显示
```

## 部署说明

### 1. 环境要求
- Python 3.7+
- 网络连接（访问 Google API）
- 可选：代理服务器

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 启动应用
```bash
# 方式1：直接运行主应用
python app.py

# 方式2：使用启动脚本
python start_web.py

# 方式3：使用运行脚本
python run.py
```

### 4. 访问应用
- 默认地址：http://localhost:5000
- 首次运行会自动创建数据库和默认配置

## 配置说明

### 系统配置项
- **check_interval**：检测间隔（分钟）
- **proxy_url**：代理服务器地址
- **use_proxy**：是否使用代理
- **api_url**：自定义 API 端点
- **concurrency**：并发检测数
- **email_enabled**：是否启用邮件通知
- **email1/2/3**：收件人邮箱地址
- **email_password**：Gmail 应用密码

### 代理配置
支持 HTTP/HTTPS 代理，格式：`http://127.0.0.1:7890`

### 自定义 API 端点
如果使用第三方 Gemini API 服务，可配置自定义端点地址

## 安全注意事项

1. **API 密钥保护**：
   - 密钥存储在本地数据库中
   - 不要将包含真实密钥的数据库文件上传到公共仓库

2. **邮件安全**：
   - 使用 Gmail 应用密码而非账户密码
   - 妥善保管邮件配置信息

3. **网络安全**：
   - 在受信任的网络环境中运行
   - 如需公网访问，请配置适当的安全措施

## 故障排除

### 常见问题

1. **密钥检测失败**
   - 检查网络连接
   - 验证代理配置
   - 确认 API 密钥格式正确

2. **邮件发送失败**
   - 确认 Gmail 应用密码正确
   - 检查收件人邮箱地址
   - 验证网络连接

3. **页面无法访问**
   - 确认服务器已启动
   - 检查端口是否被占用
   - 查看控制台错误信息

### 日志调试
- 检查 Web 界面的实时日志
- 查看控制台输出信息
- 检查数据库中的错误记录

## 扩展开发

### 添加新功能
1. 在 `app.py` 中添加新的路由
2. 在 `models.py` 中定义数据模型
3. 在前端模板中添加界面元素
4. 实现相应的业务逻辑

### 性能优化
1. 调整并发数配置
2. 优化数据库查询
3. 实现密钥检测缓存
4. 使用更高效的异步框架

## 版本历史

- **v3.0**：当前版本，包含完整的 Web 界面和邮件通知功能
- **v2.0**：增加了 Web 界面和实时日志功能
- **v1.0**：基础命令行版本

## 许可证

本项目仅供学习和研究使用，请遵守相关 API 服务的使用条款。 