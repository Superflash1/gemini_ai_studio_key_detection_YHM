<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini API Key Checker - æ§åˆ¶å°</title>
    <!-- Bootstrap CSS ä¸»CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" onerror="this.onerror=null; document.head.appendChild(Object.assign(document.createElement('link'), {rel:'stylesheet', href:'/static/css/local-bootstrap.css'}));">
    <!-- Bootstrap å›¾æ ‡ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet" onerror="this.onerror=null; console.log('Bootstrapå›¾æ ‡CDNåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°emojiå¤‡ç”¨æ–¹æ¡ˆ');">
    <!-- å¤‡ç”¨CDN -->
    <link href="https://unpkg.com/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" onerror="this.remove();">
    <!-- æœ¬åœ°å¤‡ç”¨æ ·å¼ + è‡ªå®šä¹‰æ ·å¼ -->
    <link href="/static/css/local-bootstrap.css" rel="stylesheet">
    <link href="/static/css/app.css" rel="stylesheet">
    <style>
        body { background-color: #f5f7fb; }
        .sidebar { min-height: calc(100vh - 56px); background: #ffffff; box-shadow: 0 6px 18px rgba(0,0,0,.06); border-right: 1px solid rgba(0,0,0,.05); }
        .sidebar .nav-link { color: #444; border-radius: 8px; margin: 2px 8px; }
        .sidebar .nav-link.active { background: rgba(13,110,253,.1); color: #0d6efd; font-weight: 600; }
        .brand { font-weight: 700; letter-spacing: .3px; }
        .content-wrapper { padding: 20px; }
        .section-title { font-weight: 600; }
        .log-container { height: 380px; overflow-y: auto; background: #0e0f13; color: #e5e7eb; border-radius: 12px; padding: 14px; font-family: 'Courier New', monospace; }
        .status-badge { font-size: .8rem; }
        .stat-card { border: 0; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
        .stat-card .value { font-size: 1.8rem; font-weight: 700; }
        .stat-icon { font-size: 1.2rem; opacity: .75; }
        .progress.thin { height: 8px; border-radius: 6px; }
        .key-display { font-family: 'Courier New', monospace; word-break: break-all; }
        .toolbar .btn { min-width: 40px; }
        .table thead th { border-top: 0; }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="navbar navbar-dark" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container-fluid">
            <span class="navbar-brand brand"><i class="bi bi-key"></i> Gemini API Key Checker</span>
            <div class="d-flex align-items-center gap-2">
                <small id="statusText" class="text-white-50">ç³»ç»Ÿè¿è¡Œä¸­...</small>
                <button class="btn btn-sm btn-light" id="action-open-settings" title="è®¾ç½®"><i class="bi bi-gear"></i></button>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- å·¦ä¾§ä¾§è¾¹æ  -->
            <aside class="col-12 col-md-2 sidebar glass rounded-3 my-3 py-3">
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#section-dashboard"><i class="bi bi-speedometer2 me-2"></i>ä»ªè¡¨ç›˜</a>
                    <a class="nav-link" href="#section-keys"><i class="bi bi-list me-2"></i>å¯†é’¥åˆ—è¡¨</a>
                    <a class="nav-link" href="#section-logs"><i class="bi bi-terminal me-2"></i>å®æ—¶æ—¥å¿—</a>
                </nav>
                <hr/>
                                    <div class="px-2">
                    <div class="d-grid gap-2">
                        <button id="action-check-all" class="btn btn-primary"><i class="bi bi-search"></i> æ£€æµ‹æ‰€æœ‰</button>
                        <button id="action-check-pending" class="btn btn-info"><i class="bi bi-hourglass-split"></i> åªæ£€æµ‹å¾…æ£€æµ‹</button>
                        <button id="action-force-check" class="btn btn-warning"><i class="bi bi-lightning"></i> å¼ºåˆ¶å…¨é‡</button>
                        <button id="action-stop" class="btn btn-danger"><i class="bi bi-stop-fill"></i> åœæ­¢æ£€æµ‹</button>
                    </div>
                </div>
                <hr/>
                                    <div class="px-2 d-grid gap-2">
                    <button id="action-copy-valid-lines" class="btn btn-success"><i class="bi bi-clipboard-check"></i> å¤åˆ¶æœ‰æ•ˆkey(æ¢è¡Œå½¢å¼)</button>
                    <button id="action-copy-valid-comma" class="btn btn-success"><i class="bi bi-clipboard"></i> å¤åˆ¶æœ‰æ•ˆkey(é€—å·å½¢å¼)</button>
                    <button id="action-delete-invalid" class="btn btn-danger"><i class="bi bi-trash"></i> åˆ é™¤æ— æ•ˆkey</button>
                </div>
            </aside>

            <!-- å³ä¾§ä¸»å†…å®¹ -->
            <main class="col-12 col-md-10 content-wrapper my-3">
                <!-- ä»ªè¡¨ç›˜éƒ¨åˆ† -->
                <section id="section-dashboard" class="mb-4">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <h5 class="section-title mb-0">ä»ªè¡¨ç›˜</h5>
                        <div class="toolbar d-flex gap-2">
                            <button class="btn btn-secondary" id="action-clear-logs" title="æ¸…ç©ºæ—¥å¿—"><i class="bi bi-trash"></i></button>
                            <button class="btn btn-secondary" id="action-scroll-bottom" title="æ»šåŠ¨åˆ°åº•éƒ¨"><i class="bi bi-arrow-down"></i></button>
                        </div>
                    </div>

                    <!-- ç»Ÿè®¡å¡ç‰‡ -->
                    <div class="row g-3 mb-3">
                        <div class="col-12 col-sm-6 col-lg-3">
                            <div class="card stat-card p-3">
                                <div class="d-flex align-items-center justify-content-between">
                                    <span class="text-muted">æœ‰æ•ˆå¯†é’¥</span>
                                    <i class="bi bi-check-circle text-success stat-icon"></i>
                                </div>
                                <div class="value text-success" id="validCount">{{ stats.valid_count }}</div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-lg-3">
                            <div class="card stat-card p-3">
                                <div class="d-flex align-items-center justify-content-between">
                                    <span class="text-muted">æ— æ•ˆå¯†é’¥</span>
                                    <i class="bi bi-x-circle text-danger stat-icon"></i>
                                </div>
                                <div class="value text-danger" id="invalidCount">{{ stats.invalid_count }}</div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-lg-3">
                            <div class="card stat-card p-3">
                                <div class="d-flex align-items-center justify-content-between">
                                    <span class="text-muted">å¾…æ£€æµ‹</span>
                                    <i class="bi bi-hourglass-split text-warning stat-icon"></i>
                                </div>
                                <div class="value text-warning" id="pendingCount">{{ stats.pending_count }}</div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-lg-3">
                            <div class="card stat-card p-3">
                                <div class="d-flex align-items-center justify-content-between">
                                    <span class="text-muted">å¤„ç†è¿›åº¦</span>
                                    <i class="bi bi-bar-chart-line stat-icon"></i>
                                </div>
                                <div class="progress thin mt-2">
                                    <div id="statProgressFill" class="progress-bar bg-primary" style="width: 0%"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-2">
                                    <small class="text-success">æœ‰æ•ˆ <span id="validPercent">0%</span></small>
                                    <small class="text-danger">æ— æ•ˆ <span id="invalidPercent">0%</span></small>
                                </div>
                        </div>
                    </div>
                </div>

                    <!-- æ·»åŠ å¯†é’¥å¡ç‰‡ -->
                <div class="card mb-4">
                        <div class="card-header bg-white">
                            <h6 class="mb-0"><i class="bi bi-plus-circle"></i> æ·»åŠ å¯†é’¥</h6>
                    </div>
                    <div class="card-body">
                        <form id="addKeyForm">
                            <div class="form-floating mb-3">
                                <textarea class="form-control" id="newKeys" placeholder="è¯·è¾“å…¥å¯†é’¥"></textarea>
                                    <label for="newKeys">å¯†é’¥åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œæˆ–ç”¨é€—å·åˆ†éš”ï¼‰</label>
                            </div>
                            <div class="form-text mb-3">
                                    ğŸ’¡ æ”¯æŒå¤šç§æ ¼å¼ï¼Œè‡ªåŠ¨å»é™¤å¤šä½™ç©ºæ ¼å’Œæœ«å°¾é€—å·
                            </div>
                                <div class="d-grid d-sm-flex gap-2">
                                    <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle"></i> æ·»åŠ å¹¶æ£€æµ‹</button>
                                    <button type="button" class="btn btn-secondary" onclick="window.checkAllKeys()"><i class="bi bi-arrow-clockwise"></i> æŒ‰ç­–ç•¥æ£€æµ‹</button>
                            </div>
                        </form>
                    </div>
                </div>

                    <!-- æ£€æµ‹çŠ¶æ€ä¸æ—¥å¿— -->
                    <div class="row g-3" id="section-logs">
                        <div class="col-12">
                            <div class="card mb-3">
                                <div class="card-header bg-white d-flex align-items-center justify-content-between">
                                    <h6 class="mb-0"><i class="bi bi-activity"></i> æ£€æµ‹çŠ¶æ€</h6>
                                    <button id="stop-check-btn" type="button" class="btn btn-danger btn-sm" onclick="window.stopChecking()">
                                        <i class="bi bi-stop-fill"></i> åœæ­¢
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div id="status-idle" class="text-muted"><i class="bi bi-check-circle"></i> ç©ºé—²çŠ¶æ€</div>
                                    <div id="status-checking" class="text-primary d-none">
                                        <div class="d-flex align-items-center">
                                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                            <div>
                                                <div id="check-type">æ­£åœ¨æ£€æµ‹...</div>
                                                <small id="check-duration" class="text-muted">è¿è¡Œæ—¶é—´: 0ç§’</small>
                                                <div id="stop-status" class="text-warning d-none"><small><i class="bi bi-exclamation-triangle"></i> æ­£åœ¨åœæ­¢...</small></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="bi bi-terminal"></i> å®æ—¶æ—¥å¿—</h6>
                                    <small class="text-muted" id="logStatus">æ—¥å¿—æµè¿æ¥ä¸­...</small>
                                </div>
                                <div class="card-body p-0">
                                    <div id="logContainer" class="log-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- å¯†é’¥åˆ—è¡¨ -->
                <section id="section-keys" class="mt-4">
                    <div class="card">
                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                            <h6 class="mb-0"><i class="bi bi-list"></i> å¯†é’¥åˆ—è¡¨</h6>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-primary" onclick="window.refreshKeyList()"><i class="bi bi-arrow-clockwise"></i> åˆ·æ–°</button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>å¯†é’¥</th>
                                            <th>çŠ¶æ€</th>
                                            <th>æœ€åæ£€æµ‹</th>
                                            <th>é”™è¯¯ä¿¡æ¯</th>
                                            <th>æ“ä½œ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="keyTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ç³»ç»Ÿè®¾ç½®</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                        <form id="scheduleForm">
                        <div class="row g-3">
                            <div class="col-12 col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control" id="intervalMinutes" value="{{ settings.check_interval or 60 }}" min="0" step="1" />
                                <label for="intervalMinutes">æ£€æµ‹é—´éš”ï¼ˆåˆ†é’Ÿï¼Œ0=ç¦ç”¨ï¼‰</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6">
                                <div class="form-floating">
                                    <input type="number" class="form-control" id="concurrency" value="{{ settings.concurrency or 10 }}" min="1" step="1" />
                                    <label for="concurrency">å¹¶å‘æ£€æµ‹æ•°ï¼ˆâ‰¥1ï¼Œå»ºè®®é‡åŠ›è€Œè¡Œï¼‰</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">ğŸŒ APIç«¯ç‚¹è®¾ç½®</label>
                                <div class="form-floating mb-2">
                                    <input type="text" class="form-control" id="apiUrl" value="{{ settings.api_url or '' }}" placeholder="ç•™ç©ºä½¿ç”¨Googleå®˜æ–¹API" />
                                    <label for="apiUrl">è‡ªå®šä¹‰API URL</label>
                                </div>
                                <div class="form-text">ç•™ç©ºé»˜è®¤ä½¿ç”¨Googleå®˜æ–¹APIç«¯ç‚¹ï¼Œæ”¯æŒè‡ªå®šä¹‰APIæœåŠ¡å™¨</div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">ğŸ”— ä»£ç†è®¾ç½®</label>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="useProxy" {{ 'checked' if settings.use_proxy != 'false' else '' }} />
                                    <label class="form-check-label" for="useProxy">å¯ç”¨ä»£ç†</label>
                                </div>
                                <div class="form-floating" id="proxyUrlContainer">
                                    <input type="text" class="form-control" id="proxyUrl" value="{{ settings.proxy_url or 'http://127.0.0.1:7890' }}" />
                                    <label for="proxyUrl">ä»£ç†åœ°å€</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating">
                                <select class="form-select" id="checkStrategy">
                                        <option value="all" {{ 'selected' if settings.check_strategy == 'all' else '' }}>å…¨é‡æ£€æµ‹ï¼ˆæœ‰æ•ˆ+å¾…æ£€æµ‹å¯†é’¥ï¼‰</option>
                                        <option value="incremental" {{ 'selected' if settings.check_strategy == 'incremental' else '' }}>å¢é‡æ£€æµ‹ï¼ˆ24å°æ—¶å†…æœªæ£€æµ‹çš„æœ‰æ•ˆå¯†é’¥ï¼‰</option>
                                </select>
                                <label for="checkStrategy">æ£€æµ‹ç­–ç•¥</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <label class="form-label">ğŸ“§ é‚®ä»¶é€šçŸ¥è®¾ç½®</label>
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="emailEnabled" {{ 'checked' if settings.email_enabled == 'true' else '' }} />
                                    <label class="form-check-label" for="emailEnabled">å¯ç”¨é‚®ä»¶é€šçŸ¥</label>
                                </div>
                                <div id="emailConfigContainer">
                                    <div class="mb-2"><small class="text-muted">å·²è®¾ç½®é‚®ç®±æ•°é‡: <span id="emailCount" class="badge bg-secondary">0</span></small></div>
                                    <div class="form-floating mb-2">
                                        <input type="email" class="form-control email-input" id="email1" value="{{ settings.email1 or '' }}" placeholder="é‚®ç®±åœ°å€1" />
                                        <label for="email1">é‚®ç®±åœ°å€1</label>
                                    </div>
                                    <div class="form-floating mb-2">
                                        <input type="email" class="form-control email-input" id="email2" value="{{ settings.email2 or '' }}" placeholder="é‚®ç®±åœ°å€2" />
                                        <label for="email2">é‚®ç®±åœ°å€2</label>
                                    </div>
                                    <div class="form-floating mb-2">
                                        <input type="email" class="form-control email-input" id="email3" value="{{ settings.email3 or '' }}" placeholder="é‚®ç®±åœ°å€3" />
                                        <label for="email3">é‚®ç®±åœ°å€3</label>
                                    </div>
                                    <div class="form-floating mb-2">
                                        <input type="password" class="form-control" id="emailPassword" value="{{ settings.email_password or '' }}" placeholder="Gmailåº”ç”¨å¯†ç " />
                                        <label for="emailPassword">Gmailåº”ç”¨å¯†ç </label>
                            </div>
                            <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-info btn-sm" onclick="window.sendTestEmail()"><i class="bi bi-envelope-check"></i> å‘é€æµ‹è¯•é‚®ä»¶</button>
                                    </div>
                                </div>
                                <div class="form-text mt-2">å‘é€é‚®ç®±: aa1xuyuhuayhm@gmail.comï¼Œéœ€è¦åœ¨Gmailä¸­ç”Ÿæˆåº”ç”¨å¯†ç ç”¨äºSMTPè®¤è¯</div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                    <button type="button" class="btn btn-success" id="action-save-settings"><i class="bi bi-gear"></i> ä¿å­˜è®¾ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JS èµ„æº -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" onerror="console.log('Bootstrap JS CDNåŠ è½½å¤±è´¥')"></script>
    <script src="https://unpkg.com/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" onerror="this.remove()"></script>
    <!-- åº”ç”¨è„šæœ¬ï¼ˆé‡æ„ï¼‰ -->
    <script src="/static/js/app.js"></script>
</body>
</html> 